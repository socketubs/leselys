window.crel=function(undefined){var isNode=typeof Node==="object"?function(object){return object instanceof Node}:function(object){return object&&typeof object==="object"&&typeof object.nodeType==="number"&&typeof object.nodeName==="string"};function crel(){var document=window.document,args=arguments,element=document.createElement(args[0]),settings=args[1],childIndex=2,argumentsLength=args.length,attributeMap=crel.attrMap;if(argumentsLength===1){return element}if(typeof settings!=="object"||isNode(settings)){--childIndex;settings=null}if(argumentsLength-childIndex===1&&typeof args[childIndex]==="string"&&element.textContent!==undefined){element.textContent=args[childIndex]}else{for(;childIndex<argumentsLength;++childIndex){child=args[childIndex];if(child==null){continue}if(!isNode(child)){child=document.createTextNode(child)}element.appendChild(child)}}for(var key in settings){if(!attributeMap[key]){element.setAttribute(key,settings[key])}else{var attr=crel.attrMap[key];if(typeof attr==="function"){attr(element,settings[key])}else{element.setAttribute(attr,settings[key])}}}return element}crel["attrMap"]={};crel["isNode"]=isNode;return crel}();!function(){function s(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent("on"+c,b)}function y(a){return"keypress"==a.type?String.fromCharCode(a.which):h[a.which]?h[a.which]:z[a.which]?z[a.which]:String.fromCharCode(a.which).toLowerCase()}function t(a,c){a=a||{};var b=!1,d;for(d in m)a[d]&&m[d]>c?b=!0:m[d]=0;b||(p=!1)}function A(a,c,b,d,g){var f,e,h=[],j=b.type;if(!l[a])return[];"keyup"==j&&u(a)&&(c=[a]);for(f=0;f<l[a].length;++f)if(e=l[a][f],!(e.seq&&m[e.seq]!=e.level)&&j==e.action&&("keypress"==j&&!b.metaKey&&!b.ctrlKey||c.sort().join(",")===e.modifiers.sort().join(",")))d&&e.combo==g&&l[a].splice(f,1),h.push(e);return h}function v(a,c,b){if(!k.stopCallback(c,c.target||c.srcElement,b)&&!1===a(c,b))c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.returnValue=!1,c.cancelBubble=!0}function w(a){"number"!==typeof a.which&&(a.which=a.keyCode);var c=y(a);if(c)if("keyup"==a.type&&x==c)x=!1;else{var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");var b=A(c,b,a),d,g={},f=0,e=!1;for(d=0;d<b.length;++d)b[d].seq?(e=!0,f=Math.max(f,b[d].level),g[b[d].seq]=1,v(b[d].callback,a,b[d].combo)):!e&&!p&&v(b[d].callback,a,b[d].combo);a.type==p&&!u(c)&&t(g,f)}}function u(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function B(a,c,b){if(!b){if(!q){q={};for(var d in h)95<d&&112>d||h.hasOwnProperty(d)&&(q[h[d]]=d)}b=q[a]?"keydown":"keypress"}"keypress"==b&&c.length&&(b="keydown");return b}function C(a,c,b,d,g){r[a+":"+b]=c;a=a.replace(/\s+/g," ");var f=a.split(" "),e,h,j=[];if(1<f.length){var k=a,n=b;m[k]=0;n||(n=B(f[0],[]));a=function(){p=n;++m[k];clearTimeout(D);D=setTimeout(t,1e3)};b=function(a){v(c,a,k);"keyup"!==n&&(x=y(a));setTimeout(t,10)};for(d=0;d<f.length;++d)C(f[d],d<f.length-1?a:b,n,k,d)}else{h="+"===a?["+"]:a.split("+");for(f=0;f<h.length;++f)e=h[f],E[e]&&(e=E[e]),b&&"keypress"!=b&&F[e]&&(e=F[e],j.push("shift")),u(e)&&j.push(e);b=B(e,j,b);l[e]||(l[e]=[]);A(e,j,{type:b},!d,a);l[e][d?"unshift":"push"]({callback:c,modifiers:j,action:b,seq:d,level:g,combo:a})}}for(var h={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},z={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},F={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},E={option:"alt",command:"meta","return":"enter",escape:"esc"},q,l={},r={},m={},D,x=!1,p=!1,g=1;20>g;++g)h[111+g]="f"+g;for(g=0;9>=g;++g)h[g+96]=g;s(document,"keypress",w);s(document,"keydown",w);s(document,"keyup",w);var k={bind:function(a,c,b){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)C(a[d],c,b);return this},unbind:function(a,c){return k.bind(a,function(){},c)},trigger:function(a,c){if(r[a+":"+c])r[a+":"+c]();return this},reset:function(){l={};r={};return this},stopCallback:function(a,c){return-1<(" "+c.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==c.tagName||"SELECT"==c.tagName||"TEXTAREA"==c.tagName||c.contentEditable&&"true"==c.contentEditable}};window.Mousetrap=k;"function"===typeof define&&define.amd&&define(k)}();TINY={};TINY.box=function(){var j,m,b,g,v,p=0;return{show:function(o){v={opacity:70,close:1,animate:1,fixed:1,mask:1,maskid:"",boxid:"",topsplit:2,url:0,post:0,height:0,width:0,html:0,iframe:0};for(s in o){v[s]=o[s]}if(!p){j=document.createElement("div");j.className="tbox";p=document.createElement("div");p.className="tinner";b=document.createElement("div");b.className="tcontent";m=document.createElement("div");m.className="tmask";g=document.createElement("div");g.className="tclose";g.v=0;document.body.appendChild(m);document.body.appendChild(j);j.appendChild(p);p.appendChild(b);m.onclick=g.onclick=TINY.box.hide;window.onresize=TINY.box.resize}else{j.style.display="none";clearTimeout(p.ah);if(g.v){p.removeChild(g);g.v=0}}p.id=v.boxid;m.id=v.maskid;j.style.position=v.fixed?"fixed":"absolute";if(v.html&&!v.animate){p.style.backgroundImage="none";b.innerHTML=v.html;b.style.display="";p.style.width=v.width?v.width+"px":"auto";p.style.height=v.height?v.height+"px":"auto"}else{b.style.display="none";if(!v.animate&&v.width&&v.height){p.style.width=v.width+"px";p.style.height=v.height+"px"}else{p.style.width=p.style.height="100px"}}if(v.mask){this.mask();this.alpha(m,1,v.opacity)}else{this.alpha(j,1,100)}if(v.autohide){p.ah=setTimeout(TINY.box.hide,1e3*v.autohide)}else{document.onkeyup=TINY.box.esc}if(v.mask){document.getElementsByTagName("body")[0].style.overflow="hidden"}},fill:function(c,u,k,a,w,h){if(u){if(v.image){var i=new Image;i.onload=function(){w=w||i.width;h=h||i.height;TINY.box.psh(i,a,w,h)};i.src=v.image}else if(v.iframe){this.psh('<iframe src="'+v.iframe+'" width="'+v.width+'" frameborder="0" height="'+v.height+'"></iframe>',a,w,h)}else{var x=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");x.onreadystatechange=function(){if(x.readyState==4&&x.status==200){p.style.backgroundImage="";TINY.box.psh(x.responseText,a,w,h)}};if(k){x.open("POST",c,true);x.setRequestHeader("Content-type","application/x-www-form-urlencoded");x.send(k)}else{x.open("GET",c,true);x.send(null)}}}else{this.psh(c,a,w,h)}},psh:function(c,a,w,h){if(typeof c=="object"){b.appendChild(c)}else{b.innerHTML=c}var x=p.style.width,y=p.style.height;if(!w||!h){p.style.width=w?w+"px":"";p.style.height=h?h+"px":"";b.style.display="";if(!h){h=parseInt(b.offsetHeight)}if(!w){w=parseInt(b.offsetWidth)}b.style.display="none"}p.style.width=x;p.style.height=y;this.size(w,h,a)},esc:function(e){e=e||window.event;if(e.keyCode==27){TINY.box.hide()}},hide:function(){TINY.box.alpha(j,-1,0,3);document.onkeypress=null;if(v.closejs){v.closejs()}document.getElementsByTagName("body")[0].style.overflow=""},resize:function(){TINY.box.pos();TINY.box.mask()},mask:function(){},pos:function(){var t;if(typeof v.top!="undefined"){t=v.top}else{t=this.height()/v.topsplit-j.offsetHeight/2;t=t<20?20:t}if(!v.fixed&&!v.top){t+=this.top()}j.style.top=t+"px";j.style.left=typeof v.left!="undefined"?v.left+"px":this.width()/2-j.offsetWidth/2+"px"},alpha:function(e,d,a){clearInterval(e.ai);if(d){e.style.opacity=0;e.style.filter="alpha(opacity=0)";e.style.display="block";TINY.box.pos()}e.ai=setInterval(function(){TINY.box.ta(e,a,d)},20)},ta:function(e,a,d){var o=Math.round(e.style.opacity*100);if(o==a){clearInterval(e.ai);if(d==-1){e.style.display="none";e==j?TINY.box.alpha(m,-1,0,2):b.innerHTML=p.style.backgroundImage=""}else{if(e==m){this.alpha(j,1,100)}else{j.style.filter="";TINY.box.fill(v.html||v.url,v.url||v.iframe||v.image,v.post,v.animate,v.width,v.height)}}}else{var n=a-Math.floor(Math.abs(a-o)*.5)*d;e.style.opacity=n/100;e.style.filter="alpha(opacity="+n+")"}},size:function(w,h,a){if(a){clearInterval(p.si);var wd=parseInt(p.style.width)>w?-1:1,hd=parseInt(p.style.height)>h?-1:1;p.si=setInterval(function(){TINY.box.ts(w,wd,h,hd)},20)}else{p.style.backgroundImage="none";if(v.close){p.appendChild(g);g.v=1}p.style.width=w+"px";p.style.height=h+"px";b.style.display="";this.pos();if(v.openjs){v.openjs()}}},ts:function(w,wd,h,hd){var cw=parseInt(p.style.width),ch=parseInt(p.style.height);if(cw==w&&ch==h){clearInterval(p.si);p.style.backgroundImage="none";b.style.display="block";if(v.close){p.appendChild(g);g.v=1}if(v.openjs){v.openjs()}}else{if(cw!=w){p.style.width=w-Math.floor(Math.abs(w-cw)*.6)*wd+"px"}if(ch!=h){p.style.height=h-Math.floor(Math.abs(h-ch)*.6)*hd+"px"}this.pos()}},top:function(){return document.documentElement.scrollTop||document.body.scrollTop},width:function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},height:function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},total:function(d){var b=document.body,e=document.documentElement;return d?Math.max(Math.max(b.scrollHeight,e.scrollHeight),Math.max(b.clientHeight,e.clientHeight)):Math.max(Math.max(b.scrollWidth,e.scrollWidth),Math.max(b.clientWidth,e.clientWidth))}}}();function getXMLHttpRequest(){var xhr=null;if(window.XMLHttpRequest||window.ActiveXObject){if(window.ActiveXObject){try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}}else{xhr=new XMLHttpRequest}}else{alert("Browser not supported (XMLHTTPRequest).");return null}return xhr}function sendFile(options){var form=new FormData;form.append("file",options["params"]["fileInput"]);var xhr=getXMLHttpRequest();xhr.open("POST",options["url"]);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200||xhr.status==0){var data=xhr.responseText;try{data=JSON.parse(data)}catch(e){window.location=""}if(options["callback"])options["callback"](xhr,data)}else{var data={success:false,content:{}};if(options["callback"])options["callback"](xhr,data)}}};xhr.send(form);return xhr}function ajaxRequest(options){if(options==undefined)return false;var default_options={url:undefined,method:"GET",params:{},callback:undefined,headers:{}};for(var key in default_options)if(!options[key])options[key]=default_options[key];if(options["url"]==undefined)return false;var xhr=getXMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200||xhr.status==0){var data=xhr.responseText;try{data=JSON.parse(data)}catch(e){window.location=""}if(options["callback"])options["callback"](xhr,data)}else{var data={success:false,content:{}};if(options["callback"])options["callback"](xhr,data)}}};var params="";for(var key in options["params"])params+="&"+key+"="+options["params"][key];if(params.length)params=params.substr(1-params.length);if(params.length&&options["method"]=="GET")options["url"]+="?"+params;xhr.open(options["method"],options["url"],true);if(options["method"]=="POST")xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var key in options["headers"])xhr.setRequestHeader(key,options["headers"][key]);if(options["method"]=="GET")xhr.send(null);else if(options["method"]=="POST")xhr.send(params);else xhr.send(null);return xhr}api={};api.changePassword=function(password,callback){return ajaxRequest({url:"api/set_password",method:"POST",params:{password:password},callback:callback})};api.addFeed=function(feedUrl,callback){return ajaxRequest({url:"api/add",method:"POST",params:{url:feedUrl},callback:callback})};api.deleteFeed=function(feedId,callback){return ajaxRequest({url:"api/remove/"+feedId,method:"DELETE",callback:callback})};api.setFeedSetting=function(feedId,settingKey,settingValue,callback){return ajaxRequest({url:"api/feedsettings",method:"POST",params:{feed_id:feedId,key:settingKey,value:settingValue},callback:callback})};api.importOPML=function(file,callback){return sendFile({url:"api/import/opml",params:{fileInput:file},callback:callback})};api.getSettings=function(callback){return ajaxRequest({url:"settings",method:"GET",params:{jsonify:true},callback:callback})};api.getHome=function(callback){return ajaxRequest({url:".",method:"GET",params:{jsonify:true},callback:callback})};api.getFeed=function(feedId,start,stop,callback){var start=start||0;var stop=stop||50;return ajaxRequest({url:"api/get/"+feedId,params:{start:start,stop:stop},method:"GET",callback:callback})};api.readStory=function(storyId,callback){return ajaxRequest({url:"api/read/"+storyId,method:"GET",callback:callback})};api.unreadStory=function(storyId,callback){return ajaxRequest({url:"api/unread/"+storyId,method:"GET",callback:callback})};api.setTheme=function(themeName,callback){return ajaxRequest({url:"api/settings/theme",method:"POST",params:{theme:themeName},callback:callback})};api.getCounters=function(callback){return ajaxRequest({url:"api/counters",method:"GET",callback:callback})};api.markAllAsRead=function(feedId,callback){return ajaxRequest({url:"api/all_read/"+feedId,method:"GET",callback:callback})};api.markAllAsUnread=function(feedId,callback){return ajaxRequest({url:"api/all_unread/"+feedId,method:"GET",callback:callback})};importer=false;setKeyboard();global={};global.feedStatus={};function changePassword(){var password1=document.getElementById("password1");var password2=document.getElementById("password2");document.getElementById("password-status").innerHTML="";document.getElementById("password-status").style.display="none";document.getElementById("password-form").classList.remove("warning");document.getElementById("password-form").classList.remove("success");if(password1.value!=password2.value){document.getElementById("password-status").innerHTML="Not same password";document.getElementById("password-form").classList.add("warning")}else if(!password1.value){document.getElementById("password-status").innerHTML="Password can't be empty";document.getElementById("password-form").classList.add("warning")}else{api.changePassword(password1.value);document.getElementById("password-status").innerHTML="Password changed!";password1.value="";password2.value="";document.getElementById("password-form").classList.add("success")}document.getElementById("password-status").style.display="block";setInterval(function(){document.getElementById("password-form").classList.remove("warning");document.getElementById("password-form").classList.remove("success")},1500)}function addFeed(){var url=document.getElementById("urlFeed").value;if(url==""){return false}addToggle();var add=document.getElementById("urlFeed");add.value="";if(document.getElementById("menu").getElementsByClassName("empty-feed-list")){document.getElementById("menu").getElementsByClassName("empty-feed-list")[0].style.display="none";document.getElementById("menu").getElementsByClassName("feeds-list-title")[0].style.display=""}var loader=crel("li",crel("i",{"class":"icon-tasks"})," Loading...");loader.style.display="none";loader=document.getElementById("menu").appendChild(loader);loader.style.display="";api.addFeed(url,function(req,data){if(data.success){var feedId=data.feed_id;var feedTitle=data.title;var feedURL=data.url;var feedLink=data.link;var feedCounter=data.counter;var newFeed=crel("a",{onClick:'viewFeed("'+feedId+'")',href:"#"+feedId},feedTitle+" ",crel("span",{"class":"unread-counter muted"},"("+feedCounter+")"));loader.style.display="none";loader.innerHTML=newFeed.outerHTML;loader.id=feedId;loader.setAttribute("data-link",feedLink);loader.classList.add("feed");loader.style.display="";if(feedCounter>0){loader.classList.add("unread")}if(document.getElementById("feeds-settings")){if(document.getElementById("feeds-settings").getElementsByClassName("empty-feed-list")){document.getElementById("feeds-settings").getElementsByClassName("empty-feed-list")[0].style.display="none"}var newFeedSetting=crel("li",{id:feedId+"-feeds-settings"},feedTitle," (",crel("a",{"class":"muted",href:"#",onClick:'deleteFeed("'+feedId+'")'},"remove"),") - ",crel("a",{href:feedURL,target:"_blank"},feedURL));newFeedSetting.style.display="none";newFeedSetting=document.getElementById("feeds-settings").getElementsByTagName("ul")[0].appendChild(newFeedSetting);newFeedSetting.style.display=""}}else{if(data.callback=="/api/login"){window.location="login"}loader.innerHTML='<li><i class="icon-exclamation-sign"></i> Error: '+data.output+"</li>";var clearLoader=function(){loader.style.display="none"};setTimeout(clearLoader,5e3)}})}function setFeedSetting(feedId,settingKey,settingValue){api.setFeedSetting(feedId,settingKey,settingValue,function(req,data){if(data.success){global.feedStatus.id=false;viewFeed(feedId)}})}function handleOPMLImport(evt){if(document.getElementById("upload-file-info").innerHTML==""){return false}if(importer){return false}if(window.File&&window.FileReader&&window.FileList&&window.Blob){}else{alert("The File APIs are not fully supported in this browser.");return false}importer=true;var file=document.getElementById("OPMLFile").files[0];if(!file){return false}var reader=new FileReader;reader.onload=function(OPMLFile){return function(e){api.importOPML(file,function(req,data){if(data.success){importer=false;document.getElementById("OPMLSubmit").innerHTML="Importing, reload page later...";document.getElementById("OPMLSubmit").className+=" disabled"}else{if(data.callback=="/api/login")window.location="login";document.getElementById("OPMLSubmit").innerHTML="Error: "+data.output;document.getElementById("OPMLSubmit").className+=" disabled"}})}}(file);reader.readAsText(file)}function viewSettings(callback){global.feedStatus.id=false;api.getSettings(function(req,data){if(data.success){var parser=new DOMParser;var div=parser.parseFromString(data.content,"text/html");var content=div.getElementById("content");var sidebar=div.getElementById("menu");document.getElementById("content").innerHTML=content.innerHTML;document.getElementById("menu").innerHTML=sidebar.innerHTML;if(importer){document.getElementById("OPMLSubmit").innerHTML="Last import not finished...";document.getElementById("OPMLSubmit").className+=" disabled";return false}if(document.getElementById("OPMLSubmit")){document.getElementById("OPMLSubmit").addEventListener("click",handleOPMLImport,false)}initPage();initTabs();initSettingsView();if(typeof callback!="undefined"){callback()}disableRibbon()}else{if(data.callback=="/api/login")window.location="login"}})}function viewHome(callback){global.feedStatus.id=false;api.getHome(function(req,data){if(data.success){var parser=new DOMParser;var div=parser.parseFromString(data.content,"text/html");var content=div.getElementById("content");var sidebar=div.getElementById("menu");document.getElementById("content").innerHTML=content.innerHTML;document.getElementById("menu").innerHTML=sidebar.innerHTML;initPage();disableRibbon();if(typeof callback!="undefined"){callback()}}else{if(data.callback=="/api/login")window.location="login"}})}function deleteFeed(feedId){api.deleteFeed(feedId,function(req,data){if(data.success){document.getElementById(feedId).style.display="none";var _child=document.getElementById(feedId);var _parent=document.getElementById(feedId).parentNode;_parent.removeChild(_child);var feedsNodes=document.getElementById("feeds-settings");if(typeof feedsNodes!="undefined"){var _child=document.getElementById(feedId+"-settings");var _parent=document.getElementById(feedId+"-settings").parentNode;_parent.removeChild(_child);if(feedsNodes.getElementsByTagName("li").length<1){document.getElementById("feeds-settings").getElementsByClassName("empty-feed-list")[0].style.display=""}}var feedsNodes=document.getElementById("menu").getElementsByClassName("feed");if(feedsNodes.length<1){document.getElementById("menu").getElementsByClassName("feeds-list-title")[0].style.display="none";document.getElementById("menu").getElementsByClassName("empty-feed-list")[0].style.display=""}}else{if(data.callback=="/api/login")window.location="login"}})}function listStories(feedId,data,append,callback){var append=append||false;var storyListAccordion=crel("div",{"class":"accordion",id:"story-list-accordion"});if(!append){var content="";if(data.content.length==0){content='<p style="text-align:center; margin-top: 50px"><em>Oups, there is no story here...</em></p>'}}else{var content=document.getElementById("story-list-accordion").innerHTML}for(var i=0;i<data.content.entries.length;i++){var item=data.content.entries[i];var storyId=item._id;var storyTitle=item.title;var storyAccordion=getStoryAccordionTemplate();var storyRead=item.read;if(item.feed_title)storyTitle=storyTitle+'<span class="feed-title-combined muted"> - '+item.feed_title+"</span>";storyAccordion.id=storyId;storyAccordion.getElementsByClassName("accordion-toggle")[0].setAttribute("onclick",'readStory("'+storyId+'")');storyAccordion.getElementsByClassName("accordion-toggle")[0].innerHTML=storyTitle;storyAccordion.getElementsByClassName("accordion-toggle")[0].setAttribute("name",storyId);if(storyRead==false){storyAccordion.getElementsByClassName("accordion-toggle")[0].style.fontWeight="bold";storyAccordion.classList.add("unread-story")}content+=storyAccordion.outerHTML}storyListAccordion.innerHTML=content;document.getElementById("content").innerHTML=storyListAccordion.outerHTML;var feedsList=document.getElementById("menu").getElementsByTagName("a");for(i=0;i<feedsList.length;i++){feedsList[i].classList.remove("text-error")}document.getElementById(feedId).getElementsByTagName("a")[0].classList.add("text-error");initAccordion();enableRibbon(feedId,data.content.ordering);if(typeof callback!="undefined"){callback()}}function viewFeed(feedId,callback){var feedTitle=document.getElementById(feedId);feedTitle.classList.add("selected-feed");for(var i=0;i<document.getElementsByClassName("feed").length;i++){var feed=document.getElementsByClassName("feed")[i];if(feed.getAttribute("id")!=feedId){feed.classList.remove("selected-feed")}}if(!global.feedStatus||global.feedStatus.id!=feedId){global.feedStatus.start=0;global.feedStatus.stop=50;global.feedStatus.id=feedId;var append=false;window.scrollTo(0,0)}else{if(global.feedStatus.stop>=global.feedStatus.length){return}global.feedStatus.start=global.feedStatus.start+50;global.feedStatus.stop=global.feedStatus.stop+50;var append=true}var start=global.feedStatus.start;var stop=global.feedStatus.stop;var xhr=api.getFeed(feedId,start,stop,function(req,data){if(data.success){listStories(feedId,data,append,function(){global.feedStatus.length=data.content.detail.length;if(typeof callback!="undefined")callback()})}else{if(data.callback=="/api/login")window.location="login"}})}function updateCounter(feedId,number){var counter=cleanCounter(document.getElementById(feedId).getElementsByClassName("unread-counter")[0].innerHTML);var counter=counter+number;document.getElementById(feedId).getElementsByClassName("unread-counter")[0].innerHTML="("+counter+")";if(counter==0){document.getElementById(feedId).getElementsByClassName("unread-counter")[0].style.display="none";document.getElementById(feedId).classList.remove("unread");document.getElementById(feedId).style.fontWeight="normal"}else{document.getElementById(feedId).getElementsByClassName("unread-counter")[0].innerHTML="("+counter+")";document.getElementById(feedId).getElementsByClassName("unread-counter")[0].style.display="";document.getElementById(feedId).classList.add("unread")}if(feedId!="combined-feed"&&feedId!="stared-feed"){updateCounter("combined-feed",number)}}function readStory(storyId,ignore){var ignore=ignore||false;if(ignore==true){document.getElementById(storyId).getElementsByClassName("accordion-toggle")[0].setAttribute("onclick",'readStory("'+storyId+'")');return true}var storyHeading=document.getElementById(storyId);storyHeading.classList.add("selected-story");var storyList=document.getElementsByClassName("accordion-group");for(var i=0;i<storyList.length;i++){var story=storyList[i];if(story.getAttribute("id")!=storyId){story.classList.remove("selected-story")}}if(document.getElementById(storyId).getElementsByClassName("accordion-inner")[0].innerHTML==""){document.getElementById(storyId).getElementsByClassName("accordion-inner")[0].innerHTML='<center><i class="icon-spinner icon-spin icon-3x"></i></center>'}api.readStory(storyId,function(req,data){if(!data.success){if(data.callback=="/api/login")window.location="login"}if(data.content.last_update==false){var published="No date"}else{if(data.content.last_update["min"].toString().length==1){var minutes="0"+data.content.last_update["min"]}else{var minutes=data.content.last_update["min"]}if(data.content.last_update["hour"].toString().length==1){var hours="0"+data.content.last_update["hour"]}else{var hours=data.content.last_update["hour"]}var published=data.content.last_update["year"]+"-"+data.content.last_update["month"]+"-"+data.content.last_update["day"]+"  "+hours+":"+minutes}var feedId=data.content.feed_id;var story=getStoryTemplate();var storyLink=story.getElementsByClassName("story-link")[0];storyLink.href=data.content.link;Mousetrap.unbind("v");Mousetrap.bind("v",function(){window.open(storyLink.href,"_blank")});story.getElementsByClassName("story-read-toggle")[0].setAttribute("onclick",'unreadStory("'+storyId+'")');story.getElementsByClassName("story-read-toggle")[0].innerHTML="Mark as unread";story.getElementsByClassName("story-read-toggle")[0].href="#"+storyId;story.getElementsByClassName("story-content")[0].innerHTML=data.content.description;story.getElementsByClassName("story-date")[0].innerHTML=published;document.getElementById(storyId).getElementsByClassName("accordion-inner")[0].innerHTML=story.innerHTML;document.getElementById(storyId).getElementsByClassName("story-read-toggle")[0].addEventListener("click",function(e){e.preventDefault()},false);if(data.success){document.getElementById(storyId).classList.remove("unread-story");updateCounter(feedId,-1)}});document.getElementById(storyId).getElementsByClassName("accordion-toggle")[0].style.fontWeight="normal"}function unreadStory(storyId){api.unreadStory(storyId,function(req,data){if(data.success){var feedId=data.content.feed_id;var story=document.getElementById(storyId);story.classList.add("unread-story");document.getElementById(storyId).getElementsByClassName("accordion-toggle")[0].setAttribute("onclick",'readStory("'+storyId+'", true)');story.getElementsByClassName("story-read-toggle")[0].setAttribute("onclick",'readStory("'+storyId+'")');story.getElementsByClassName("story-read-toggle")[0].innerHTML="Mark as read";updateCounter(feedId,1);document.getElementById(storyId).getElementsByClassName("accordion-toggle")[0].style.fontWeight="bold"}else{if(data.callback=="/api/login")window.location="login"}})}function loadTheme(themeName,callback){api.setTheme(themeName,function(req,data){window.location=""})}function refreshCounters(){api.getCounters(function(req,data){if(data.success){for(i=0;i<data.content.length;i++){var feed=data.content[i];var feedId=feed[0];var feedCounter=feed[1];document.getElementById(feedId).getElementsByClassName("unread-counter")[0].innerHTML="("+feedCounter+")";if(feedCounter>0){document.getElementById(feedId).classList.add("unread");document.getElementById(feedId).getElementsByClassName("unread-counter")[0].style.display=""}else{document.getElementById(feedId).classList.remove("unread");document.getElementById(feedId).getElementsByClassName("unread-counter")[0].style.display="none"}}}else{if(data.callback=="/api/login")window.location="login"}})}function initAddFeed(){var addFeed=getAddFeedTemplate();document.getElementById("menu").appendChild(addFeed)}function initSettingsView(){document.getElementById("OPMLSubmit").addEventListener("click",handleOPMLImport,false);document.getElementById("OPMLFile").addEventListener("change",function(){document.getElementById("upload-file-info").innerHTML=document.getElementById("OPMLFile").value.replace("C:\\fakepath\\","")});document.getElementById("password2").onkeypress=function(e){if(!e)e=window.event;if(e.keyCode=="13"){changePassword();return false}}}function initPage(){var feeds=document.getElementById("menu").getElementsByClassName("feed");addEventListenerList(feeds,"click",function(e){e.preventDefault()});var combinedFeed=document.getElementById("combined-feed");if(combinedFeed)combinedFeed.addEventListener("click",function(e){e.preventDefault()});var staredFeed=document.getElementById("stared-feed");if(staredFeed)staredFeed.addEventListener("click",function(e){e.preventDefault()});bindInfinityScroll();initAddFeed();setInterval(refreshCounters,12e4)}function bindInfinityScroll(){if(window.addEventListener){document.addEventListener("scroll",function(){getScroll(function(height){if(!global.loading){if(height>=70){global.loading=true;viewFeed(getCurrentFeedId(),function(){global.loading=false})}}})},false)}}function getScroll(callback){var percent=(document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;if(typeof callback!="undefined")callback(percent)}function initTabs(){for(var i=0;i<document.getElementsByClassName("tabbable").length;i++){var table=document.getElementsByClassName("tabbable")[i];for(var j=0;j<table.getElementsByClassName("nav-tabs")[0].getElementsByTagName("li").length;j++){var tab=table.getElementsByClassName("nav-tabs")[0].getElementsByTagName("li")[j];var contentId=tab.getElementsByTagName("a")[0].getAttribute("href").substr(1);var content=document.getElementById(contentId);if(!content.classList.contains("active")){content.style.display="none"}tab.getElementsByTagName("a")[0].addEventListener("click",function(e){var _id=this.getAttribute("href").substr(1);var content=document.getElementById(_id);this.parentNode.classList.add("active");content.classList.add("active");content.style.display="block";hideTabs(this.parentNode);e.preventDefault()})}}}function hideTabs(tab){var contentId=tab.getElementsByTagName("a")[0].getAttribute("href").substr(1);var table=tab.parentNode.parentNode;for(var i=0;i<table.getElementsByClassName("nav-tabs")[0].getElementsByTagName("li").length;i++){var tab=table.getElementsByClassName("nav-tabs")[0].getElementsByTagName("li")[i];var tabId=tab.getElementsByTagName("a")[0].getAttribute("href").substr(1);if(tabId!=contentId){tab.classList.remove("active");document.getElementById(tabId).classList.remove("active");document.getElementById(tabId).style.display="none"}}}function initAccordion(){for(var i=0;i<document.getElementsByClassName("accordion").length;i++){var accordion=document.getElementsByClassName("accordion")[i];for(var j=0;j<accordion.getElementsByClassName("accordion-group").length;j++){var accordionGroup=accordion.getElementsByClassName("accordion-group")[j];var heading=accordionGroup.getElementsByClassName("accordion-heading")[0];var body=accordionGroup.getElementsByClassName("accordion-inner")[0];heading.style.height="auto";heading.addEventListener("click",function(){var body=this.parentNode.getElementsByClassName("accordion-inner")[0];if(body.style.display==""){body.style.display="none"}else{body.style.display="";body.style.height="auto";collapseIn(this.parentNode)}});body.style.display="none";body.style.height="0px";body.style.overflow="hidden"}}}function collapseIn(accordionGroupRoot){var accordion=accordionGroupRoot.parentNode;for(var i=0;i<accordion.getElementsByClassName("accordion-group").length;i++){var accordionGroup=accordion.getElementsByClassName("accordion-group")[i];if(accordionGroup!=accordionGroupRoot){var heading=accordionGroup.getElementsByClassName("accordion-heading")[0];var body=accordionGroup.getElementsByClassName("accordion-inner")[0];body.style.display="none";body.style.height="0px"}}}function markAllAsRead(feedId){api.markAllAsRead(feedId,function(req,data){global.feedStatus.id=false;viewFeed(feedId);refreshCounters()})}function markAllAsUnread(feedId){api.markAllAsUnread(feedId,function(req,data){global.feedStatus.id=false;
viewFeed(feedId);refreshCounters()})}function enableRibbon(feedId,ordering){var ribbon=document.getElementById("ribbon");ribbon.classList.remove("hidden");ribbon.classList.remove("ribbon-three");if(ordering=="unreaded"){ribbon.getElementsByClassName("order-unreaded")[0].classList.add("active");ribbon.getElementsByClassName("order-published")[0].classList.remove("active")}else if(ordering=="published"){ribbon.getElementsByClassName("order-unreaded")[0].classList.remove("active");ribbon.getElementsByClassName("order-published")[0].classList.add("active")}ribbon.getElementsByClassName("order-unreaded")[0].getElementsByTagName("a")[0].onclick=function(){setFeedSetting(feedId,"ordering","unreaded")};ribbon.getElementsByClassName("order-published")[0].getElementsByTagName("a")[0].onclick=function(){setFeedSetting(feedId,"ordering","published")};if(feedId=="combined-feed"){ribbon.getElementsByClassName("mark-all-as-unread")[0].classList.add("hidden");ribbon.classList.add("ribbon-three")}else if(feedId=="stared-feed"){ribbon.classList.add("hidden");return}else{ribbon.getElementsByClassName("mark-all-as-unread")[0].classList.remove("hidden")}ribbon.getElementsByClassName("mark-all-as-read")[0].getElementsByTagName("a")[0].onclick=function(){var onclick='markAllAsRead("'+feedId+'");TINY.box.hide();';var box=getMarkAllConfirmationTemplate("Mark all as read ?",feedId,onclick);TINY.box.show({html:box.outerHTML,maskopacity:40,maskid:"confirmation-mask"})};ribbon.getElementsByClassName("mark-all-as-unread")[0].getElementsByTagName("a")[0].onclick=function(){var onclick='markAllAsUnread("'+feedId+'");TINY.box.hide();';var box=getMarkAllConfirmationTemplate("Mark all as unread ?",feedId,onclick);TINY.box.show({html:box.outerHTML,maskopacity:40,maskid:"confirmation-mask"})}}function disableRibbon(){var ribbon=document.getElementById("ribbon");ribbon.classList.add("hidden")}function getCurrentFeedLink(){if(document.getElementsByClassName("selected-feed").length>0)return document.getElementsByClassName("selected-feed")[0].getAttribute("data-link")}function getCurrentFeedId(){if(document.getElementsByClassName("selected-feed").length>0)return document.getElementsByClassName("selected-feed")[0].id}function getCurrentStory(){var story=document.getElementsByClassName("selected-story")[0];if(typeof story==="undefined"){return false}return story}function getNextStory(){var story=document.getElementsByClassName("selected-story")[0];if(typeof story==="undefined"){story=document.getElementsByClassName("accordion-group")[0];if(typeof story==="undefined"){return false}return story}if(story.nextSibling==null){return false}return story.nextSibling}function getPreviousStory(){var story=document.getElementsByClassName("selected-story")[0];if(typeof story==="undefined"){return false}if(story.previousSibling==null){return false}return story.previousSibling}function toggleReadState(storyId){var story=document.getElementById(storyId);if(story.classList.contains("unread-story")){readStory(storyId)}else{unreadStory(storyId)}}function setKeyboard(){Mousetrap.bind("g h",function(){viewHome()});Mousetrap.bind("g a",function(){viewFeed("combined-feed")});Mousetrap.bind("r",function(){refreshCounters()});Mousetrap.bind("a",function(){addToggle()});Mousetrap.bind("?",function(){viewSettings(function(){var navList=document.getElementById("content").getElementsByClassName("nav-tabs")[0].getElementsByTagName("li");var contentList=document.getElementById("content").getElementsByClassName("tab-content")[0].getElementsByClassName("tab-pane");for(i=0;i<navList.length;i++){navList[i].classList.remove("active");contentList[i].classList.remove("active");if(navList[i].getElementsByTagName("a")[0].getAttribute("href")=="#help"){navList[i].classList.add("active");contentList[i].classList.add("active");contentList[i].style.display="block"}}})});Mousetrap.bind("m",function(){var story=getCurrentStory();if(story==false){return}toggleReadState(story.getAttribute("id"))});Mousetrap.bind("o",function(){var story=getCurrentStory();if(story==false){return}story.getElementsByTagName("a")[0].click()});Mousetrap.bind("j",function(){var nextStory=getNextStory();if(nextStory==false){return}nextStory.getElementsByTagName("a")[0].click();nextStory.scrollIntoView()});Mousetrap.bind("k",function(){var previousStory=getPreviousStory();if(previousStory==false){return}previousStory.getElementsByTagName("a")[0].click();previousStory.scrollIntoView()});Mousetrap.bind("b",function(){var link=getCurrentFeedLink();if(link){window.open(link,"_blank")}})}function addEventListenerList(list,event,fn){for(var i=0,len=list.length;i<len;i++){list[i].addEventListener(event,fn,false)}}function addToggle(){var add=document.getElementById("add");Mousetrap.reset();if(add.style.display=="block"){add.style.display="none";setKeyboard();return}add.style.display="block";document.getElementById("urlFeed").focus();Mousetrap.bind("esc",function(e,combo){addToggle()})}function cleanCounter(counter){return parseInt(counter.substr(1,counter.length-2))}!function(DOMParser){"use strict";var DOMParser_proto=DOMParser.prototype,real_parseFromString=DOMParser_proto.parseFromString;try{if((new DOMParser).parseFromString("","text/html")){return}}catch(ex){}DOMParser_proto.parseFromString=function(markup,type){if(/^\s*text\/html\s*(?:;|$)/i.test(type)){var doc=document.implementation.createHTMLDocument("");doc.body.innerHTML=markup;return doc}else{return real_parseFromString.apply(this,arguments)}}}(DOMParser);"use strict";if(typeof document!=="undefined"&&!("classList"in document.createElement("a"))){!function(a){var f="classList",d="prototype",e=(a.HTMLElement||a.Element)[d],g=Object;strTrim=String[d].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[d].indexOf||function(k){for(var j=0,h=this.length;j<h;j++){if(j in this&&this[j]===k){return j}}return-1},DOMEx=function(h,i){this.name=h;this.code=DOMException[h];this.message=i},checkTokenAndGetIndex=function(i,h){if(h===""){throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(h)){throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character")}return arrIndexOf.call(i,h)},ClassList=function(m){var l=strTrim.call(m.className),k=l?l.split(/\s+/):[];for(var j=0,h=k.length;j<h;j++){this.push(k[j])}this._updateClassName=function(){m.className=this.toString()}},classListProto=ClassList[d]=[],classListGetter=function(){return new ClassList(this)};DOMEx[d]=Error[d];classListProto.item=function(h){return this[h]||null};classListProto.contains=function(h){h+="";return checkTokenAndGetIndex(this,h)!==-1};classListProto.add=function(h){h+="";if(checkTokenAndGetIndex(this,h)===-1){this.push(h);this._updateClassName()}};classListProto.remove=function(i){i+="";var h=checkTokenAndGetIndex(this,i);if(h!==-1){this.splice(h,1);this._updateClassName()}};classListProto.toggle=function(h){h+="";if(checkTokenAndGetIndex(this,h)===-1){this.add(h)}else{this.remove(h)}};classListProto.toString=function(){return this.join(" ")};if(g.defineProperty){var c={get:classListGetter,enumerable:true,configurable:true};try{g.defineProperty(e,f,c)}catch(b){if(b.number===-2146823252){c.enumerable=false;g.defineProperty(e,f,c)}}}else{if(g[d].__defineGetter__){e.__defineGetter__(f,classListGetter)}}}(self)}